function initialize(){var e={zoom:14,center:new google.maps.LatLng(25.0504416,121.5414189),mapTypeId:google.maps.MapTypeId.TERRAIN};map=new google.maps.Map(document.getElementById("map"),e)}function d3Map(){d3.json("https://tcgbusfs.blob.core.windows.net/blobfs/GetDisasterSummary.json",function(e){var a=e.DataSet["diffgr:diffgram"].NewDataSet.CASE_SUMMARY,t=[];a.map(function(e){t.push(new google.maps.LatLng(e.Wgs84Y,e.Wgs84X))}),draw_heatmap(t),$('input[name="isShow"]').change(function(){var e=$(this).val();"0"===e?clean_markers():add_markers(t,a)})})}function add_markers(e,a){for(var t=new google.maps.InfoWindow,o=function(e){var a=new google.maps.Marker({map:map,position:new google.maps.LatLng(e.Wgs84Y,e.Wgs84X),title:e.PName+" - "+e.Name});a.content='<div class="infoWindowContent">發生時間：'+(isEmpty(d[n].CaseTime)?"":e.CaseTime)+"</br>災情地點："+e.CaseLocationDescription+"</br>災情描述："+e.CaseDescription+"</div>","true"===e.CaseComplete&&a.setIcon("http://maps.google.com/mapfiles/ms/icons/green-dot.png"),google.maps.event.addListener(a,"click",function(){t.setContent("<h3>"+a.title+"</h3>"+a.content),t.open(map,a)}),markers.push(a)},n=0;n<a.length;n++)o(a[n])}function clean_markers(){for(var e=0;e<markers.length;e++)markers[e].setMap(null);markers=[]}function draw_heatmap(e){var a=new google.maps.MVCArray(e),t=new google.maps.visualization.HeatmapLayer({data:a});t.setMap(map)}function isEmpty(e){return"undefined"==typeof e||!e||0===e.length}!function(){var e=angular.module("app",[]);e.controller("GetDisasterSummary",["$scope","$http",function(e,a){e.orderByField="CaseTime",e.reverseSort=!0,e.total={"路樹災情":0,"民生、基礎設施災情":0,"建物毀損":0,"廣告招牌災情":0,"積淹水災情":0,"其他災情":0,"環境污染":0,"土石災情":0,"道路、隧道災情":0,"水利設施災情":0,"鐵路、高鐵及捷運災情":0,"車輛及交通事故":0},e.doneTotal={"路樹災情":0,"民生、基礎設施災情":0,"建物毀損":0,"廣告招牌災情":0,"積淹水災情":0,"其他災情":0,"環境污染":0,"土石災情":0,"道路、隧道災情":0,"水利設施災情":0,"鐵路、高鐵及捷運災情":0,"車輛及交通事故":0},a.get("https://tcgbusfs.blob.core.windows.net/blobfs/GetDisasterSummary.json").success(function(a,t,o,n){d=a.DataSet["diffgr:diffgram"].NewDataSet.CASE_SUMMARY,e.dataTime=a.DataSet["-date"],e.cases=d;var s=0,m=0,r=0;for(i=0;i<d.length;i++)"true"===d[i].CaseComplete?(s+=1,"路樹災情"===d[i].PName&&(e.doneTotal["路樹災情"]+=1),"民生、基礎設施災情"===d[i].PName&&(e.doneTotal["民生、基礎設施災情"]+=1),"建物毀損"===d[i].PName&&(e.doneTotal["建物毀損"]+=1),"廣告招牌災情"===d[i].PName&&(e.doneTotal["廣告招牌災情"]+=1),"積淹水災情"===d[i].PName&&(e.doneTotal["積淹水災情"]+=1),"其他災情"===d[i].PName&&(e.doneTotal["其他災情"]+=1),"土石災情"===d[i].PName&&(e.doneTotal["土石災情"]+=1),"道路、隧道災情"===d[i].PName&&(e.doneTotal["道路、隧道災情"]+=1),"水利設施災害"===d[i].PName&&(e.doneTotal["水利設施災情"]+=1),"鐵路、高鐵及捷運災情"===d[i].PName&&(e.doneTotal["鐵路、高鐵及捷運災情"]+=1),"車輛及交通事故"===d[i].PName&&(e.doneTotal["車輛及交通事故"]+=1)):m+=1,"路樹災情"===d[i].PName&&(e.total["路樹災情"]+=1),"民生、基礎設施災情"===d[i].PName&&(e.total["民生、基礎設施災情"]+=1),"建物毀損"===d[i].PName&&(e.total["建物毀損"]+=1),"廣告招牌災情"===d[i].PName&&(e.total["廣告招牌災情"]+=1),"積淹水災情"===d[i].PName&&(e.total["積淹水災情"]+=1),"其他災情"===d[i].PName&&(e.total["其他災情"]+=1),"土石災情"===d[i].PName&&(e.total["土石災情"]+=1),"道路、隧道災情"===d[i].PName&&(e.total["道路、隧道災情"]+=1),"水利設施災害"===d[i].PName&&(e.total["水利設施災情"]+=1),"鐵路、高鐵及捷運災情"===d[i].PName&&(e.total["鐵路、高鐵及捷運災情"]+=1),"車輛及交通事故"===d[i].PName&&(e.total["車輛及交通事故"]+=1);r=100*s/(s+m),e.caseDone=s,e.caseInProgress=m,e.caseRate=r.toFixed(2)}).error(function(e,a,t,o){console.log("http error")})}]),initialize(),d3Map()}();var map,markers=[];
//# sourceMappingURL=all.min.js.map