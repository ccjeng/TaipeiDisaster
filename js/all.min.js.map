{"version":3,"sources":["main.js"],"names":["isEmpty","str","length","app","angular","module","controller","$scope","$http","orderByField","reverseSort","mapOptions","zoom","center","google","maps","LatLng","mapTypeId","MapTypeId","ROADMAP","map","Map","document","getElementById","markers","infoWindow","InfoWindow","createMarker","data","pinImage","word","pinColor","CaseComplete","PName","MarkerImage","marker","Marker","position","Wgs84Y","Wgs84X","title","Name","pid","toLowerCase","icon","content","CaseTime","CaseLocationDescription","CaseDescription","event","addListener","setContent","open","push","total","路樹災情","民生、基礎設施災情","建物毀損","廣告招牌災情","積淹水災情","其他災情","環境污染","土石災情","道路、隧道災情","水利設施災情","鐵路、高鐵及捷運災情","車輛及交通事故","doneTotal","get","success","status","headers","config","d","DataSet","NewDataSet","dataTime","cases","caseDone","caseInProgress","caseRate","i","toFixed","MarkerClusterer","gridSize","maxZoom","error","console","log","itemClicked","e","index","trigger"],"mappings":"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","file":"all.min.js","sourcesContent":["\n(function(){\n\nvar app = angular.module('app', []);\n\napp.controller('GetDisasterSummary', ['$scope', '$http', function($scope, $http) {\n\n    $scope.orderByField = 'CaseTime';\n    $scope.reverseSort = true;\n\n\n    var mapOptions = {\n        zoom: 13,\n        center: new google.maps.LatLng(25.037525,121.563782),\n        mapTypeId: google.maps.MapTypeId.ROADMAP\n    };\n    $scope.map = new google.maps.Map(document.getElementById('map'), mapOptions);\n\n    $scope.markers = [];\n\n    var infoWindow = new google.maps.InfoWindow();\n/*\n    var draw_heatmap = function(info) {\n        var heatMapData = new google.maps.MVCArray(info);\n        var heatmap = new google.maps.visualization.HeatmapLayer({ data: heatMapData });\n        heatmap.setMap($scope.map);\n    };\n*/\n    var createMarker = function (data){\n      \n        var pinColor = (data.CaseComplete === \"true\") ? \"80e516\" : \"FE7569\";\n        var pinImage; \n        var word;\n\n        switch(data.PName) {\n          case '路樹災情':\n              word='樹';\n              break;\n          case '民生、基礎設施災情':\n              word='民';\n              break;\n          case '建物毀損':\n              word='建';\n              break;\n          case '廣告招牌災情':\n              word='廣';\n              break;\n          case '積淹水災情':\n              word='水';\n              break;\n          case '其他災情':\n              word='其';\n              break;\n          case '環境污染':\n              word='污';\n              break;\n          case '土石災情':\n              word='土';\n              break;\n          case '道路、隧道災情':\n              word='路';\n              break;\n          case '鐵路、高鐵及捷運災情':\n              word='運';\n              break;  \n          case '車輛及交通事故':\n              word='車';\n              break;                                   \n          default:\n              word='危';              \n        };\n\n        if(data.CaseComplete === \"true\"){\n            word = \"復\";\n            pinImage = new google.maps.MarkerImage(\"http://chart.apis.google.com/chart?chst=d_map_spin&chld=0.7|0|\"+ pinColor +\"|15|b|\"+word);\n        } else {\n            pinImage = new google.maps.MarkerImage(\"http://chart.apis.google.com/chart?chst=d_map_spin&chld=0.7|20|\"+ pinColor +\"|15|b|\"+word);\n        }\n\n        var marker = new google.maps.Marker({\n            map: $scope.map,\n            position: new google.maps.LatLng(data.Wgs84Y, data.Wgs84X),\n            title: data.PName + ' - '+ data.Name,\n            pid: data['-diffgr:id'].toLowerCase(),\n            icon: pinImage,\n            pinColor: pinColor\n        });\n\n        marker.content = '<div class=\"infoWindowContent\">發生時間：' + data.CaseTime\n          + '</br>災情地點：' + data.CaseLocationDescription\n          + '</br>災情描述：' + data.CaseDescription \n          + '</div>';\n\n        google.maps.event.addListener(marker, 'click', function(){\n            infoWindow.setContent('<h3>' + marker.title + '</h3>' + marker.content );\n            infoWindow.open($scope.map, marker);\n        });\n        \n        $scope.markers.push(marker);\n        \n    };\n/*\n    var cleanMarker = function() {\n        var markers = $scope.markers;\n        for (var i = 0; i < markers.length; i++) { markers[i].setMap(null); }\n        $scope.markers = [];\n    };\n*/\n    $scope.total = {\n      '路樹災情': 0,\n      '民生、基礎設施災情': 0,\n      '建物毀損': 0,\n      '廣告招牌災情': 0,\n      '積淹水災情': 0,\n      '其他災情': 0,\n      '環境污染': 0,\n      '土石災情': 0,\n      '道路、隧道災情': 0,\n      '水利設施災情': 0,\n      '鐵路、高鐵及捷運災情': 0,\n      '車輛及交通事故': 0\n    };\n\n    $scope.doneTotal = {\n      '路樹災情': 0,\n      '民生、基礎設施災情': 0,\n      '建物毀損': 0,\n      '廣告招牌災情': 0,\n      '積淹水災情': 0,\n      '其他災情': 0,\n      '環境污染': 0,\n      '土石災情': 0,\n      '道路、隧道災情': 0,\n      '水利設施災情': 0,\n      '鐵路、高鐵及捷運災情': 0,\n      '車輛及交通事故': 0\n    };\n\n    //$scope.listDistrict = ['中正區','大同區','中山區','松山區','大安區','萬華區','信義區','士林區','北投區','內湖區','南港區','文山區'];\n\n    //$http.get('http://tonyq.org/kptaipei/GetDisasterSummary-20150808.php')\n    //$http.get('./data/GetDisasterSummary.json')\n\n    $http.get('https://tcgbusfs.blob.core.windows.net/blobfs/GetDisasterSummary.json')        \n    .success(function(data, status, headers, config) {\n      d = data.DataSet['diffgr:diffgram'].NewDataSet['CASE_SUMMARY'];\n\n      $scope.dataTime = data.DataSet['-date'];\n      $scope.cases = d;\n\n/*\n    var locationCoords = [];\n\n    d.map(function(p){\n      locationCoords.push( new google.maps.LatLng(p.Wgs84Y, p.Wgs84X) );\n    });\n\n    draw_heatmap(locationCoords);\n*/\n\n      var caseDone = 0, caseInProgress = 0, caseRate = 0.00;\n      for (i = 0; i < d.length; i++){\n        createMarker(d[i]);\n      \n        if (d[i].CaseComplete==='true') {\n            caseDone = caseDone + 1;\n  \n            if (d[i].PName==='路樹災情') {\n              $scope.doneTotal['路樹災情'] += 1;\n            }\n            if (d[i].PName==='民生、基礎設施災情') {\n              $scope.doneTotal['民生、基礎設施災情'] += 1;\n            }\n            if (d[i].PName==='建物毀損') {\n              $scope.doneTotal['建物毀損'] += 1;\n            }\n            if (d[i].PName==='廣告招牌災情') {\n              $scope.doneTotal['廣告招牌災情'] += 1;\n            }\n            if (d[i].PName==='積淹水災情') {\n              $scope.doneTotal['積淹水災情'] += 1;\n            }\n            if (d[i].PName==='其他災情') {\n              $scope.doneTotal['其他災情'] += 1;\n            }\n            if (d[i].PName==='土石災情') {\n              $scope.doneTotal['土石災情'] += 1;\n            }\n            if (d[i].PName==='道路、隧道災情') {\n              $scope.doneTotal['道路、隧道災情'] += 1;\n            }\n            if (d[i].PName==='水利設施災害') {\n              $scope.doneTotal['水利設施災情'] += 1;\n            }\n            if (d[i].PName==='鐵路、高鐵及捷運災情') {\n              $scope.doneTotal['鐵路、高鐵及捷運災情'] += 1;\n            }\n            if (d[i].PName==='車輛及交通事故') {\n              $scope.doneTotal['車輛及交通事故'] += 1;\n            }\n        }else {\n            caseInProgress = caseInProgress + 1;\n        }\n\n        if (d[i].PName==='路樹災情') {\n          $scope.total['路樹災情'] += 1;\n        }\n        if (d[i].PName==='民生、基礎設施災情') {\n          $scope.total['民生、基礎設施災情'] += 1;\n        }\n        if (d[i].PName==='建物毀損') {\n          $scope.total['建物毀損'] += 1;\n        }\n        if (d[i].PName==='廣告招牌災情') {\n          $scope.total['廣告招牌災情'] += 1;\n        }\n        if (d[i].PName==='積淹水災情') {\n          $scope.total['積淹水災情'] += 1;\n        }\n        if (d[i].PName==='其他災情') {\n          $scope.total['其他災情'] += 1;\n        }\n        if (d[i].PName==='土石災情') {\n          $scope.total['土石災情'] += 1;\n        }\n        if (d[i].PName==='道路、隧道災情') {\n          $scope.total['道路、隧道災情'] += 1;\n        }\n        if (d[i].PName==='水利設施災害') {\n          $scope.total['水利設施災情'] += 1;\n        }\n        if (d[i].PName==='鐵路、高鐵及捷運災情') {\n          $scope.total['鐵路、高鐵及捷運災情'] += 1;\n        }\n        if (d[i].PName==='車輛及交通事故') {\n          $scope.total['車輛及交通事故'] += 1;\n        }\n    \n\n      }\n\n        caseRate = 100 * caseDone / (caseDone + caseInProgress);\n\n        $scope.caseDone = caseDone;\n        $scope.caseInProgress = caseInProgress;\n        $scope.caseRate = caseRate.toFixed(2);\n\n         var mc = new MarkerClusterer($scope.map, $scope.markers, {gridSize: 80, maxZoom: 16});\n      })\n\n\n    .error(function(data, status, headers, config) {\n      // log error\n      console.log('http error');\n    });\n\n    //http://jsfiddle.net/pc7Uu/854/\n    $scope.itemClicked = function (e, index) {\n        //e.preventDefault();\n        google.maps.event.trigger($scope.markers[index], 'click');\n    };\n\n\n}]);\n\n\n})();\n\n\nfunction isEmpty(str) {\n    return ((typeof str == 'undefined')|| !str || 0 === str.length);\n}\n"],"sourceRoot":"/source/"}