{"version":3,"sources":["main.js"],"names":["isEmpty","str","length","app","angular","module","controller","$scope","$http","orderByField","reverseSort","mapOptions","zoom","center","google","maps","LatLng","mapTypeId","MapTypeId","TERRAIN","map","Map","document","getElementById","markers","infoWindow","InfoWindow","createMarker","info","marker","Marker","position","Wgs84Y","Wgs84X","title","PName","Name","content","d","i","CaseTime","CaseLocationDescription","CaseDescription","CaseComplete","setIcon","event","addListener","setContent","open","push","total","路樹災情","民生、基礎設施災情","建物毀損","廣告招牌災情","積淹水災情","其他災情","環境污染","土石災情","道路、隧道災情","水利設施災情","鐵路、高鐵及捷運災情","車輛及交通事故","doneTotal","listDistrict","get","success","data","status","headers","config","DataSet","NewDataSet","cases","caseDone","caseInProgress","caseRate","toFixed","error","console","log","openInfoWindow","e","selectedMarker","trigger"],"mappings":"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","file":"all.min.js","sourcesContent":["\n(function(){\n\nvar app = angular.module('app', []);\n\napp.controller('GetDisasterSummary', ['$scope', '$http', function($scope, $http) {\n\n    $scope.orderByField = 'CaseTime';\n    $scope.reverseSort = true;\n\n\n    var mapOptions = {\n        zoom: 16,\n        center: new google.maps.LatLng(25.0504416, 121.5414189),\n        mapTypeId: google.maps.MapTypeId.TERRAIN\n    };\n    $scope.map = new google.maps.Map(document.getElementById('map'), mapOptions);\n\n    $scope.markers = [];\n\n    var infoWindow = new google.maps.InfoWindow();\n\n    var createMarker = function (info){\n      \n        var marker = new google.maps.Marker({\n            map: $scope.map,\n            position: new google.maps.LatLng(info.Wgs84Y, info.Wgs84X),\n            title: info.PName + ' - '+ info.Name,\n        });\n\n\n        marker.content = '<div class=\"infoWindowContent\">發生時間：' + (isEmpty(d[i].CaseTime) ? '' : info.CaseTime)\n          + '</br>災情地點：' + info.CaseLocationDescription\n          + '</br>災情描述：' + info.CaseDescription \n          + '</div>';\n        \n        if (info.CaseComplete==='true') {\n          marker.setIcon('http://maps.google.com/mapfiles/ms/icons/green-dot.png');\n        }\n\n        google.maps.event.addListener(marker, 'click', function(){\n            infoWindow.setContent('<h3>' + marker.title + '</h3>' + marker.content );\n            infoWindow.open($scope.map, marker);\n        });\n        \n        $scope.markers.push(marker);\n        \n    };\n\n    $scope.total = {\n      '路樹災情': 0,\n      '民生、基礎設施災情': 0,\n      '建物毀損': 0,\n      '廣告招牌災情': 0,\n      '積淹水災情': 0,\n      '其他災情': 0,\n      '環境污染': 0,\n      '土石災情': 0,\n      '道路、隧道災情': 0,\n      '水利設施災情': 0,\n      '鐵路、高鐵及捷運災情': 0,\n      '車輛及交通事故': 0\n    };\n\n    $scope.doneTotal = {\n      '路樹災情': 0,\n      '民生、基礎設施災情': 0,\n      '建物毀損': 0,\n      '廣告招牌災情': 0,\n      '積淹水災情': 0,\n      '其他災情': 0,\n      '環境污染': 0,\n      '土石災情': 0,\n      '道路、隧道災情': 0,\n      '水利設施災情': 0,\n      '鐵路、高鐵及捷運災情': 0,\n      '車輛及交通事故': 0\n    };\n\n    $scope.listDistrict = ['中正區','大同區','中山區','松山區','大安區','萬華區','信義區','士林區','北投區','內湖區','南港區','文山區'];\n\n    //$http.get('http://tonyq.org/kptaipei/GetDisasterSummary-20150808.php')\n    $http.get('https://tcgbusfs.blob.core.windows.net/blobfs/GetDisasterSummary.json')    \n    //$http.get('./data/GetDisasterSummary.json')\n    \n    .success(function(data, status, headers, config) {\n      //console.log('call json');\n\n      //d = data.DataSet['diffgr:diffgram'].NewDataSet['CASE_SUMMARY'];\n      d = data.DataSet['diffgr:diffgram'].NewDataSet['CASE_SUMMARY'];\n      //console.log(d);\n\n      $scope.cases = d;\n\n      var caseDone = 0, caseInProgress = 0, caseRate = 0.00;\n      for (i = 0; i < d.length; i++){\n        createMarker(d[i]);\n      \n        if (d[i].CaseComplete==='true') {\n            caseDone = caseDone + 1;\n  \n            if (d[i].PName==='路樹災情') {\n              $scope.doneTotal['路樹災情'] += 1;\n            }\n            if (d[i].PName==='民生、基礎設施災情') {\n              $scope.doneTotal['民生、基礎設施災情'] += 1;\n            }\n            if (d[i].PName==='建物毀損') {\n              $scope.doneTotal['建物毀損'] += 1;\n            }\n            if (d[i].PName==='廣告招牌災情') {\n              $scope.doneTotal['廣告招牌災情'] += 1;\n            }\n            if (d[i].PName==='積淹水災情') {\n              $scope.doneTotal['積淹水災情'] += 1;\n            }\n            if (d[i].PName==='其他災情') {\n              $scope.doneTotal['其他災情'] += 1;\n            }\n            if (d[i].PName==='土石災情') {\n              $scope.doneTotal['土石災情'] += 1;\n            }\n            if (d[i].PName==='道路、隧道災情') {\n              $scope.doneTotal['道路、隧道災情'] += 1;\n            }\n            if (d[i].PName==='水利設施災害') {\n              $scope.doneTotal['水利設施災情'] += 1;\n            }\n            if (d[i].PName==='鐵路、高鐵及捷運災情') {\n              $scope.doneTotal['鐵路、高鐵及捷運災情'] += 1;\n            }\n            if (d[i].PName==='車輛及交通事故') {\n              $scope.doneTotal['車輛及交通事故'] += 1;\n            }\n        }else {\n            caseInProgress = caseInProgress + 1;\n        }\n\n        if (d[i].PName==='路樹災情') {\n          $scope.total['路樹災情'] += 1;\n        }\n        if (d[i].PName==='民生、基礎設施災情') {\n          $scope.total['民生、基礎設施災情'] += 1;\n        }\n        if (d[i].PName==='建物毀損') {\n          $scope.total['建物毀損'] += 1;\n        }\n        if (d[i].PName==='廣告招牌災情') {\n          $scope.total['廣告招牌災情'] += 1;\n        }\n        if (d[i].PName==='積淹水災情') {\n          $scope.total['積淹水災情'] += 1;\n        }\n        if (d[i].PName==='其他災情') {\n          $scope.total['其他災情'] += 1;\n        }\n        if (d[i].PName==='土石災情') {\n          $scope.total['土石災情'] += 1;\n        }\n        if (d[i].PName==='道路、隧道災情') {\n          $scope.total['道路、隧道災情'] += 1;\n        }\n        if (d[i].PName==='水利設施災害') {\n          $scope.total['水利設施災情'] += 1;\n        }\n        if (d[i].PName==='鐵路、高鐵及捷運災情') {\n          $scope.total['鐵路、高鐵及捷運災情'] += 1;\n        }\n        if (d[i].PName==='車輛及交通事故') {\n          $scope.total['車輛及交通事故'] += 1;\n        }\n    \n\n      }\n\n      caseRate = 100 * caseDone / (caseDone + caseInProgress)\n\n      $scope.caseDone = caseDone;\n      $scope.caseInProgress = caseInProgress;\n      $scope.caseRate = caseRate.toFixed(2);\n\n      })\n\n\n    .error(function(data, status, headers, config) {\n      // log error\n      console.log('http error');\n    });\n\n    //http://jsfiddle.net/pc7Uu/854/\n    $scope.openInfoWindow = function(e, selectedMarker){\n        //e.preventDefault();\n        google.maps.event.trigger(selectedMarker, 'click');\n        console.log(selectedMarker);\n    }\n\n}]);\n\n\n})();\n\nfunction isEmpty(str) {\n    return ((typeof str == 'undefined')|| !str || 0 === str.length);\n}\n"],"sourceRoot":"/source/"}