{"version":3,"sources":["main.js"],"names":["initialize","mapOptions","zoom","center","google","maps","LatLng","mapTypeId","MapTypeId","TERRAIN","map","Map","document","getElementById","d3Map","d3","json","data","result","DataSet","NewDataSet","locationCoords","d","push","Wgs84Y","Wgs84X","draw_heatmap","$","change","val","this","clean_markers","add_markers","points","infoWindow","InfoWindow","createMarker","info","marker","Marker","position","title","PName","Name","content","isEmpty","i","CaseTime","CaseLocationDescription","CaseDescription","CaseComplete","setIcon","event","addListener","setContent","open","markers","length","setMap","coords","pointArray","MVCArray","heatmap","visualization","HeatmapLayer","str","app","angular","module","controller","$scope","$http","orderByField","reverseSort","total","路樹災情","民生、基礎設施災情","建物毀損","廣告招牌災情","積淹水災情","其他災情","環境污染","土石災情","道路、隧道災情","水利設施災情","鐵路、高鐵及捷運災情","車輛及交通事故","doneTotal","get","success","status","headers","config","dataTime","cases","caseDone","caseInProgress","caseRate","toFixed","error","console","log"],"mappings":"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","file":"all.min.js","sourcesContent":["\n(function(){\n\nvar app = angular.module('app', []);\n\napp.controller('GetDisasterSummary', ['$scope', '$http', function($scope, $http) {\n\n    $scope.orderByField = 'CaseTime';\n    $scope.reverseSort = true;\n\n/*\n    var mapOptions = {\n        zoom: 16,\n        center: new google.maps.LatLng(25.0504416, 121.5414189),\n        mapTypeId: google.maps.MapTypeId.TERRAIN\n    };\n    $scope.map = new google.maps.Map(document.getElementById('map'), mapOptions);\n\n    $scope.markers = [];\n\n    var infoWindow = new google.maps.InfoWindow();\n\n    var createMarker = function (info){\n      \n        var marker = new google.maps.Marker({\n            map: $scope.map,\n            position: new google.maps.LatLng(info.Wgs84Y, info.Wgs84X),\n            title: info.PName + ' - '+ info.Name,\n        });\n\n        marker.content = '<div class=\"infoWindowContent\">發生時間：' + (isEmpty(d[i].CaseTime) ? '' : info.CaseTime)\n          + '</br>災情地點：' + info.CaseLocationDescription\n          + '</br>災情描述：' + info.CaseDescription \n          + '</div>';\n        \n        if (info.CaseComplete==='true') {\n          marker.setIcon('http://maps.google.com/mapfiles/ms/icons/green-dot.png');\n        }\n\n        google.maps.event.addListener(marker, 'click', function(){\n            infoWindow.setContent('<h3>' + marker.title + '</h3>' + marker.content );\n            infoWindow.open($scope.map, marker);\n        });\n        \n        $scope.markers.push(marker);\n        \n    };\n*/\n    $scope.total = {\n      '路樹災情': 0,\n      '民生、基礎設施災情': 0,\n      '建物毀損': 0,\n      '廣告招牌災情': 0,\n      '積淹水災情': 0,\n      '其他災情': 0,\n      '環境污染': 0,\n      '土石災情': 0,\n      '道路、隧道災情': 0,\n      '水利設施災情': 0,\n      '鐵路、高鐵及捷運災情': 0,\n      '車輛及交通事故': 0\n    };\n\n    $scope.doneTotal = {\n      '路樹災情': 0,\n      '民生、基礎設施災情': 0,\n      '建物毀損': 0,\n      '廣告招牌災情': 0,\n      '積淹水災情': 0,\n      '其他災情': 0,\n      '環境污染': 0,\n      '土石災情': 0,\n      '道路、隧道災情': 0,\n      '水利設施災情': 0,\n      '鐵路、高鐵及捷運災情': 0,\n      '車輛及交通事故': 0\n    };\n\n    //$scope.listDistrict = ['中正區','大同區','中山區','松山區','大安區','萬華區','信義區','士林區','北投區','內湖區','南港區','文山區'];\n\n    //$http.get('http://tonyq.org/kptaipei/GetDisasterSummary-20150808.php')\n    $http.get('https://tcgbusfs.blob.core.windows.net/blobfs/GetDisasterSummary.json')    \n    //$http.get('./data/GetDisasterSummary.json')\n    \n    .success(function(data, status, headers, config) {\n      //d = data.DataSet['diffgr:diffgram'].NewDataSet['CASE_SUMMARY'];\n      d = data.DataSet['diffgr:diffgram'].NewDataSet['CASE_SUMMARY'];\n\n      $scope.dataTime = data.DataSet['-date'];\n      $scope.cases = d;\n\n\n      var caseDone = 0, caseInProgress = 0, caseRate = 0.00;\n      for (i = 0; i < d.length; i++){\n        //createMarker(d[i]);\n      \n        if (d[i].CaseComplete==='true') {\n            caseDone = caseDone + 1;\n  \n            if (d[i].PName==='路樹災情') {\n              $scope.doneTotal['路樹災情'] += 1;\n            }\n            if (d[i].PName==='民生、基礎設施災情') {\n              $scope.doneTotal['民生、基礎設施災情'] += 1;\n            }\n            if (d[i].PName==='建物毀損') {\n              $scope.doneTotal['建物毀損'] += 1;\n            }\n            if (d[i].PName==='廣告招牌災情') {\n              $scope.doneTotal['廣告招牌災情'] += 1;\n            }\n            if (d[i].PName==='積淹水災情') {\n              $scope.doneTotal['積淹水災情'] += 1;\n            }\n            if (d[i].PName==='其他災情') {\n              $scope.doneTotal['其他災情'] += 1;\n            }\n            if (d[i].PName==='土石災情') {\n              $scope.doneTotal['土石災情'] += 1;\n            }\n            if (d[i].PName==='道路、隧道災情') {\n              $scope.doneTotal['道路、隧道災情'] += 1;\n            }\n            if (d[i].PName==='水利設施災害') {\n              $scope.doneTotal['水利設施災情'] += 1;\n            }\n            if (d[i].PName==='鐵路、高鐵及捷運災情') {\n              $scope.doneTotal['鐵路、高鐵及捷運災情'] += 1;\n            }\n            if (d[i].PName==='車輛及交通事故') {\n              $scope.doneTotal['車輛及交通事故'] += 1;\n            }\n        }else {\n            caseInProgress = caseInProgress + 1;\n        }\n\n        if (d[i].PName==='路樹災情') {\n          $scope.total['路樹災情'] += 1;\n        }\n        if (d[i].PName==='民生、基礎設施災情') {\n          $scope.total['民生、基礎設施災情'] += 1;\n        }\n        if (d[i].PName==='建物毀損') {\n          $scope.total['建物毀損'] += 1;\n        }\n        if (d[i].PName==='廣告招牌災情') {\n          $scope.total['廣告招牌災情'] += 1;\n        }\n        if (d[i].PName==='積淹水災情') {\n          $scope.total['積淹水災情'] += 1;\n        }\n        if (d[i].PName==='其他災情') {\n          $scope.total['其他災情'] += 1;\n        }\n        if (d[i].PName==='土石災情') {\n          $scope.total['土石災情'] += 1;\n        }\n        if (d[i].PName==='道路、隧道災情') {\n          $scope.total['道路、隧道災情'] += 1;\n        }\n        if (d[i].PName==='水利設施災害') {\n          $scope.total['水利設施災情'] += 1;\n        }\n        if (d[i].PName==='鐵路、高鐵及捷運災情') {\n          $scope.total['鐵路、高鐵及捷運災情'] += 1;\n        }\n        if (d[i].PName==='車輛及交通事故') {\n          $scope.total['車輛及交通事故'] += 1;\n        }\n    \n\n      }\n\n      caseRate = 100 * caseDone / (caseDone + caseInProgress)\n\n      $scope.caseDone = caseDone;\n      $scope.caseInProgress = caseInProgress;\n      $scope.caseRate = caseRate.toFixed(2);\n\n      })\n\n\n    .error(function(data, status, headers, config) {\n      // log error\n      console.log('http error');\n    });\n\n    //http://jsfiddle.net/pc7Uu/854/\n    /*\n    $scope.openInfoWindow = function(e, selectedMarker){\n        //e.preventDefault();\n        google.maps.event.trigger(selectedMarker, 'click');\n        console.log(selectedMarker);\n    }*/\n\n}]);\n\n\n\ninitialize();\nd3Map();\n\n\n})();\n\nvar map;\nvar markers = [];\n\nfunction initialize() {\n  var mapOptions = {\n        zoom: 14,\n        center: new google.maps.LatLng(25.0504416, 121.5414189),\n        mapTypeId: google.maps.MapTypeId.TERRAIN\n    };\n  map = new google.maps.Map( document.getElementById('map') , mapOptions);\n}\n\nfunction d3Map() {\n    d3.json('https://tcgbusfs.blob.core.windows.net/blobfs/GetDisasterSummary.json', function(data){\n    var result = data.DataSet['diffgr:diffgram'].NewDataSet['CASE_SUMMARY'];\n    var locationCoords = [];\n\n    result.map(function(d){\n      locationCoords.push( new google.maps.LatLng(d.Wgs84Y, d.Wgs84X) );\n    });\n\n    draw_heatmap(locationCoords);\n\n    $('input[name=\"isShow\"]').change(function(){\n    var val = $(this).val();\n    if( val === '0' ){\n      clean_markers();\n    }else{\n      add_markers(locationCoords, result);\n    }\n  });\n\n  });\n}\n\nfunction add_markers(points, result) {\n  var infoWindow = new google.maps.InfoWindow();\n\n  var createMarker = function (info){\n      \n        var marker = new google.maps.Marker({\n            map: map,\n            position: new google.maps.LatLng(info.Wgs84Y, info.Wgs84X),\n            title: info.PName + ' - '+ info.Name,\n        });\n\n        marker.content = '<div class=\"infoWindowContent\">發生時間：' + (isEmpty(d[i].CaseTime) ? '' : info.CaseTime)\n          + '</br>災情地點：' + info.CaseLocationDescription\n          + '</br>災情描述：' + info.CaseDescription \n          + '</div>';\n        \n        if (info.CaseComplete==='true') {\n          marker.setIcon('http://maps.google.com/mapfiles/ms/icons/green-dot.png');\n        }\n\n        google.maps.event.addListener(marker, 'click', function(){\n            infoWindow.setContent('<h3>' + marker.title + '</h3>' + marker.content );\n            infoWindow.open(map, marker);\n        });\n        \n        markers.push(marker);\n        \n    };\n\n  for (var i = 0; i < result.length; i++) {\n    createMarker(result[i]);\n  }\n\n\n\n}\n\nfunction clean_markers() {\n  for (var i = 0; i < markers.length; i++) { markers[i].setMap(null); }\n  markers = [];\n}\n\n\nfunction draw_heatmap(coords) {\n  var pointArray = new google.maps.MVCArray(coords);\n  var heatmap = new google.maps.visualization.HeatmapLayer({ data: pointArray });\n  heatmap.setMap(map);\n}\n\n\nfunction isEmpty(str) {\n    return ((typeof str == 'undefined')|| !str || 0 === str.length);\n}\n"],"sourceRoot":"/source/"}