{"version":3,"sources":["main.js"],"names":["isEmpty","str","length","app","angular","module","controller","$scope","$http","orderByField","reverseSort","mapOptions","zoom","center","google","maps","LatLng","mapTypeId","MapTypeId","ROADMAP","map","Map","document","getElementById","markers","infoWindow","InfoWindow","createMarker","info","marker","Marker","position","Wgs84Y","Wgs84X","title","PName","Name","content","CaseTime","CaseLocationDescription","CaseDescription","CaseComplete","setIcon","event","addListener","setContent","open","push","total","路樹災情","民生、基礎設施災情","建物毀損","廣告招牌災情","積淹水災情","其他災情","環境污染","土石災情","道路、隧道災情","水利設施災情","鐵路、高鐵及捷運災情","車輛及交通事故","doneTotal","get","success","data","status","headers","config","d","DataSet","NewDataSet","dataTime","cases","caseDone","caseInProgress","caseRate","i","toFixed","MarkerClusterer","gridSize","maxZoom","error","console","log"],"mappings":"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","file":"all.min.js","sourcesContent":["\n(function(){\n\nvar app = angular.module('app', []);\n\napp.controller('GetDisasterSummary', ['$scope', '$http', function($scope, $http) {\n\n    $scope.orderByField = 'CaseTime';\n    $scope.reverseSort = true;\n\n\n    var mapOptions = {\n        zoom: 13,\n        center: new google.maps.LatLng(25.037525,121.563782),\n        mapTypeId: google.maps.MapTypeId.ROADMAP\n    };\n    $scope.map = new google.maps.Map(document.getElementById('map'), mapOptions);\n\n    $scope.markers = [];\n\n    var infoWindow = new google.maps.InfoWindow();\n/*\n    var draw_heatmap = function(info) {\n        var heatMapData = new google.maps.MVCArray(info);\n        var heatmap = new google.maps.visualization.HeatmapLayer({ data: heatMapData });\n        heatmap.setMap($scope.map);\n    };\n*/\n    var createMarker = function (info){\n      \n        var marker = new google.maps.Marker({\n            map: $scope.map,\n            position: new google.maps.LatLng(info.Wgs84Y, info.Wgs84X),\n            title: info.PName + ' - '+ info.Name,\n        });\n\n        marker.content = '<div class=\"infoWindowContent\">發生時間：' + info.CaseTime\n          + '</br>災情地點：' + info.CaseLocationDescription\n          + '</br>災情描述：' + info.CaseDescription \n          + '</div>';\n        \n        if (info.CaseComplete==='true') {\n          marker.setIcon('http://maps.google.com/mapfiles/ms/icons/green-dot.png');\n        }\n\n        google.maps.event.addListener(marker, 'click', function(){\n            infoWindow.setContent('<h3>' + marker.title + '</h3>' + marker.content );\n            infoWindow.open($scope.map, marker);\n        });\n        \n        $scope.markers.push(marker);\n        \n    };\n\n    var cleanMarker = function() {\n        var markers = $scope.markers;\n        for (var i = 0; i < markers.length; i++) { markers[i].setMap(null); }\n        $scope.markers = [];\n    }\n\n    $scope.total = {\n      '路樹災情': 0,\n      '民生、基礎設施災情': 0,\n      '建物毀損': 0,\n      '廣告招牌災情': 0,\n      '積淹水災情': 0,\n      '其他災情': 0,\n      '環境污染': 0,\n      '土石災情': 0,\n      '道路、隧道災情': 0,\n      '水利設施災情': 0,\n      '鐵路、高鐵及捷運災情': 0,\n      '車輛及交通事故': 0\n    };\n\n    $scope.doneTotal = {\n      '路樹災情': 0,\n      '民生、基礎設施災情': 0,\n      '建物毀損': 0,\n      '廣告招牌災情': 0,\n      '積淹水災情': 0,\n      '其他災情': 0,\n      '環境污染': 0,\n      '土石災情': 0,\n      '道路、隧道災情': 0,\n      '水利設施災情': 0,\n      '鐵路、高鐵及捷運災情': 0,\n      '車輛及交通事故': 0\n    };\n\n    //$scope.listDistrict = ['中正區','大同區','中山區','松山區','大安區','萬華區','信義區','士林區','北投區','內湖區','南港區','文山區'];\n\n    //$http.get('http://tonyq.org/kptaipei/GetDisasterSummary-20150808.php')\n    $http.get('https://tcgbusfs.blob.core.windows.net/blobfs/GetDisasterSummary.json')    \n    //$http.get('./data/GetDisasterSummary.json')\n    \n    .success(function(data, status, headers, config) {\n      d = data.DataSet['diffgr:diffgram'].NewDataSet['CASE_SUMMARY'];\n\n      $scope.dataTime = data.DataSet['-date'];\n      $scope.cases = d;\n\n/*\n    var locationCoords = [];\n\n    d.map(function(p){\n      locationCoords.push( new google.maps.LatLng(p.Wgs84Y, p.Wgs84X) );\n    });\n\n    draw_heatmap(locationCoords);\n*/\n\n      var caseDone = 0, caseInProgress = 0, caseRate = 0.00;\n      for (i = 0; i < d.length; i++){\n        createMarker(d[i]);\n      \n        if (d[i].CaseComplete==='true') {\n            caseDone = caseDone + 1;\n  \n            if (d[i].PName==='路樹災情') {\n              $scope.doneTotal['路樹災情'] += 1;\n            }\n            if (d[i].PName==='民生、基礎設施災情') {\n              $scope.doneTotal['民生、基礎設施災情'] += 1;\n            }\n            if (d[i].PName==='建物毀損') {\n              $scope.doneTotal['建物毀損'] += 1;\n            }\n            if (d[i].PName==='廣告招牌災情') {\n              $scope.doneTotal['廣告招牌災情'] += 1;\n            }\n            if (d[i].PName==='積淹水災情') {\n              $scope.doneTotal['積淹水災情'] += 1;\n            }\n            if (d[i].PName==='其他災情') {\n              $scope.doneTotal['其他災情'] += 1;\n            }\n            if (d[i].PName==='土石災情') {\n              $scope.doneTotal['土石災情'] += 1;\n            }\n            if (d[i].PName==='道路、隧道災情') {\n              $scope.doneTotal['道路、隧道災情'] += 1;\n            }\n            if (d[i].PName==='水利設施災害') {\n              $scope.doneTotal['水利設施災情'] += 1;\n            }\n            if (d[i].PName==='鐵路、高鐵及捷運災情') {\n              $scope.doneTotal['鐵路、高鐵及捷運災情'] += 1;\n            }\n            if (d[i].PName==='車輛及交通事故') {\n              $scope.doneTotal['車輛及交通事故'] += 1;\n            }\n        }else {\n            caseInProgress = caseInProgress + 1;\n        }\n\n        if (d[i].PName==='路樹災情') {\n          $scope.total['路樹災情'] += 1;\n        }\n        if (d[i].PName==='民生、基礎設施災情') {\n          $scope.total['民生、基礎設施災情'] += 1;\n        }\n        if (d[i].PName==='建物毀損') {\n          $scope.total['建物毀損'] += 1;\n        }\n        if (d[i].PName==='廣告招牌災情') {\n          $scope.total['廣告招牌災情'] += 1;\n        }\n        if (d[i].PName==='積淹水災情') {\n          $scope.total['積淹水災情'] += 1;\n        }\n        if (d[i].PName==='其他災情') {\n          $scope.total['其他災情'] += 1;\n        }\n        if (d[i].PName==='土石災情') {\n          $scope.total['土石災情'] += 1;\n        }\n        if (d[i].PName==='道路、隧道災情') {\n          $scope.total['道路、隧道災情'] += 1;\n        }\n        if (d[i].PName==='水利設施災害') {\n          $scope.total['水利設施災情'] += 1;\n        }\n        if (d[i].PName==='鐵路、高鐵及捷運災情') {\n          $scope.total['鐵路、高鐵及捷運災情'] += 1;\n        }\n        if (d[i].PName==='車輛及交通事故') {\n          $scope.total['車輛及交通事故'] += 1;\n        }\n    \n\n      }\n\n        caseRate = 100 * caseDone / (caseDone + caseInProgress)\n\n        $scope.caseDone = caseDone;\n        $scope.caseInProgress = caseInProgress;\n        $scope.caseRate = caseRate.toFixed(2);\n\n         var mc = new MarkerClusterer($scope.map, $scope.markers, {gridSize: 80, maxZoom: 16});\n      })\n\n\n    .error(function(data, status, headers, config) {\n      // log error\n      console.log('http error');\n    });\n\n    //http://jsfiddle.net/pc7Uu/854/\n    /*\n    $scope.openInfoWindow = function(e, selectedMarker){\n        //e.preventDefault();\n        google.maps.event.trigger(selectedMarker, 'click');\n        console.log(selectedMarker);\n    }*/\n\n/*\n    $('input[name=\"isShow\"]').change(function(){\n      var val = $(this).val();\n      if( val === '0' ){\n          cleanMarker();\n      }else{\n        for (var i = 0; i < d.length; i++) {\n          createMarker(d[i]);\n        }\n        var mc = new MarkerClusterer($scope.map, $scope.markers, {gridSize: 80, maxZoom: 16});\n      }\n    });\n*/\n\n}]);\n\n\n})();\n\n\nfunction isEmpty(str) {\n    return ((typeof str == 'undefined')|| !str || 0 === str.length);\n}\n"],"sourceRoot":"/source/"}